#include <Wire.h>
#include <MPU6050.h>
#include <Servo.h>

MPU6050 mpu;
Servo servo;

#define SERVO_PIN 9
#define GREEN_LED 4
#define RED_LED 3

void setup() {
  Serial.begin(9600);   // Communication with Python
  Wire.begin();
  mpu.initialize();

  servo.attach(SERVO_PIN);
  servo.write(90);      // Locked position

  pinMode(GREEN_LED, OUTPUT);
  pinMode(RED_LED, OUTPUT);
  digitalWrite(RED_LED, HIGH);
  digitalWrite(GREEN_LED, LOW);

  Serial.println("Arduino ready.");
}

void loop() {
  // --- Send MPU6050 Data to Python ---
  int16_t ax, ay, az, gx, gy, gz;
  mpu.getMotion6(&ax, &ay, &az, &gx, &gy, &gz);
  Serial.print(ax); Serial.print(",");
  Serial.print(ay); Serial.print(",");
  Serial.println(az);
  delay(100);

  // --- Receive Python Commands ---
  if (Serial.available() > 0) {
    char cmd = Serial.read();
    if (cmd == 'A') {
      servo.write(180);                  // Unlock
      digitalWrite(GREEN_LED, HIGH);
      digitalWrite(RED_LED, LOW);
    } else if (cmd == 'D') {
      servo.write(90);                   // Lock
      digitalWrite(GREEN_LED, LOW);
      digitalWrite(RED_LED, HIGH);
    }
  }
}
